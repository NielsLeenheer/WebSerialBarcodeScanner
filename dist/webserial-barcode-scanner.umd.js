!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).WebSerialBarcodeScanner=t()}(this,(function(){"use strict";class e{constructor(e){this._events={}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}emit(e,...t){let n=this._events[e];n&&n.forEach((e=>{setTimeout((()=>e(...t)),0)}))}}class t{static detect(e){return e.startsWith("http")?"qrcode":e.match(/^[0-9]+$/)&&8==e.length?"ean8":e.match(/^[0-9]+$/)&&12==e.length?"upca":e.match(/^[0-9]+$/)&&13==e.length?"ean13":e.match(/^M[0-9]/)?"aztec-code":e.length>32?"qrcode":void 0}}return class{constructor(t){this._internal={emitter:new e,port:null,reader:null,options:Object.assign({baudRate:9600,bufferSize:255,dataBits:8,flowControl:"none",parity:"none",stopBits:1,guessSymbology:!1},t)},navigator.serial.addEventListener("disconnect",(e=>{this._internal.port==e.target&&this._internal.emitter.emit("disconnected")}))}async connect(){try{let e=await navigator.serial.requestPort();e&&await this.open(e)}catch(e){console.log("Could not connect! "+e)}}async reconnect(e){if(!e.vendorId||!e.productId)return;let t=(await navigator.serial.getPorts()).filter((t=>{let n=t.getInfo();return n.usbVendorId==e.vendorId&&n.usbProductId==e.productId}));1==t.length&&await this.open(t[0])}async disconnect(){this._internal.port&&(this._internal.reader.releaseLock(),await this._internal.port.close(),this._internal.port=null,this._internal.reader=null,this._internal.emitter.emit("disconnected"))}async open(e){this._internal.port=e,await this._internal.port.open(this._internal.options);let n=this._internal.port.getInfo();this._internal.emitter.emit("connected",{type:"serial",vendorId:n.usbVendorId||null,productId:n.usbProductId||null});let r="";for(;e.readable;){this._internal.reader=e.readable.getReader();try{for(;;){const{value:e,done:n}=await this._internal.reader.read();if(n){this._internal.reader.releaseLock();break}if(e)for(let n=0;n<e.length;n++){let i=e[n];if(13!==i)r+=String.fromCharCode(i);else{let e={value:r};if(this.options.guessSymbology){let n=t.detect(r);n&&(e.symbology=n,e.guess=!0)}this._internal.emitter.emit("barcode",e),r=""}}}}catch(e){r=""}}}addEventListener(e,t){this._internal.emitter.on(e,t)}}}));
//# sourceMappingURL=webserial-barcode-scanner.umd.js.map
